{"componentChunkName":"component---src-templates-info-page-template-js","path":"/3-challenges","result":{"data":{"page":{"htmlAst":{"type":"root","children":[{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are things which make testing more challenging. Many of them are global variables of sorts. Global variables cause spooky action at a distance. Do the same thing over and over again, and get a different result. Tests may randomly pass or fail, depending on the order in which they are run."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"singletons","style":"position:relative;"},"children":[{"type":"text","value":"Singletons"},{"type":"element","tagName":"a","properties":{"href":"#singletons","ariaLabel":"singletons permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Singleton_pattern","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Singleton"}]},{"type":"text","value":" is an anti-pattern. It is the object-oriented equivalent of a global variable. Instead, "},{"type":"element","tagName":"a","properties":{"href":"http://www.butunclebob.com/ArticleS.UncleBob.SingletonVsJustCreateOne","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"just create one"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"test-doubles","style":"position:relative;"},"children":[{"type":"text","value":"Test doubles"},{"type":"element","tagName":"a","properties":{"href":"#test-doubles","ariaLabel":"test doubles permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the SUT (system under test) is not a pure function and it's hard to test together with the real objects, its dependencies can be replaced with "},{"type":"element","tagName":"a","properties":{"href":"https://martinfowler.com/bliki/TestDouble.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"test doubles"}]},{"type":"text","value":". The dependencies can be provided as method or constructor arguments (aka dependency injection)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are five main categories of test doubles:"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Dummy"}]},{"type":"text","value":" is a placeholder to make the code compile, but doesn't affect the SUT."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Stub"}]},{"type":"text","value":" returns data to the SUT e.g. using hard-coded method return values."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Spy"}]},{"type":"text","value":" records how the SUT calls the spy, so that the test can afterwards assert on the recorded data."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Mock"}]},{"type":"text","value":" contains pre-recorded expectations on how the SUT should call it, and will itself automatically verify the expectations. Requires a mocking framework."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"strong","properties":{},"children":[{"type":"text","value":"Fake"}]},{"type":"text","value":" is a simplified implementation of a dependency, not appropriate for production use, e.g. persistence layer based on a hashmap."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Only mock types you own."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Read more:\n"},{"type":"element","tagName":"a","properties":{"href":"https://jesusvalerareales.medium.com/testing-with-test-doubles-7c3abb9eb3f2","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://jesusvalerareales.medium.com/testing-with-test-doubles-7c3abb9eb3f2"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/@xpmatteo/how-i-learned-to-love-mocks-1-fb341b71328","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://medium.com/@xpmatteo/how-i-learned-to-love-mocks-1-fb341b71328"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"london-school-of-tdd","style":"position:relative;"},"children":[{"type":"text","value":"London school of TDD"},{"type":"element","tagName":"a","properties":{"href":"#london-school-of-tdd","ariaLabel":"london school of tdd permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Mock objects were invented in a London meetup, and it gave birth to a mock-based outside-in approach to TDD, which is commonly called London style TDD. This is in contrast to Detroit/Chicago style TDD, where the code is typically written bottom-up and dependencies are faked only when they complicate testing (named such because Chrysler's C3 project, which gave birth to Extreme Programming, happened in Detroit). They are also known as mockist and classicist styles."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"London style TDD focuses on the communication protocols between objects sending messages to each other. It goes hand-in-hand "},{"type":"element","tagName":"a","properties":{"href":"https://groups.google.com/g/growing-object-oriented-software/c/-t6fp3392oM/m/QO342CHAAwAJ","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"[1]"}]},{"type":"text","value":" with "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Alan_Kay","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Alan Kay"}]},{"type":"text","value":"'s view of object-oriented programming, where objects are like individual computers on the network sending messages to each other (thus Erlang is the most object-oriented programming language)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"When using mock objects, it's important to understand the object-oriented style for which they were created. Otherwise, over-mocking may lead to tight coupling between tests and implementation details. The best description of how mock objects were meant to be used is the book "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Growing Object-Oriented Software, Guided by Tests"}]},{"type":"text","value":" (Steve Freeman, Nat Pryce 2009)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Read more:\n"},{"type":"element","tagName":"a","properties":{"href":"http://www.mockobjects.com/2009/09/brief-history-of-mock-objects.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"http://www.mockobjects.com/2009/09/brief-history-of-mock-objects.html"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"a","properties":{"href":"https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"file-system","style":"position:relative;"},"children":[{"type":"text","value":"File system"},{"type":"element","tagName":"a","properties":{"href":"#file-system","ariaLabel":"file system permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The file system is a global variable which persists between test executions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If a test needs to write to the disk, create a unique temporary directory on test setup and delete it recursively on teardown."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If the test process is killed or there are file locks, the teardown may not be able to delete the temporary directory. Avoid using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/tmp"}]},{"type":"text","value":" and instead place the temporary directory inside the project directory, under the build target directory, so that any stale directories will be removed on a clean build."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"database","style":"position:relative;"},"children":[{"type":"text","value":"Database"},{"type":"element","tagName":"a","properties":{"href":"#database","ariaLabel":"database permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The database is a global variable which persists between test executions."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Make it easy to run the tests locally. "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/compose/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Docker Compose"}]},{"type":"text","value":" is simple and easy. For cloud-only databases, using a development instance in the cloud is necessary."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Usually tests create the database schema on test setup, and remove it on teardown. Another style is to remove and recreate the schema on test setup, which makes it the responsibility of the next test to clean up what the previous test produced. Clean-before allows peeking the data after a test run, but you would still need to focus run a single test, so commenting out the teardown or using a sleep gives the same effect with the clean-after approach. Mom always told to clean up after yourself."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"In focused integration tests, it may be possible to run each test in a rollback-only transaction. This should make tests faster by avoiding the need to recreate the database schema for each test. If more than one thread is involved or the SUT is complex, this strategy is usually not possible."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tests may create their own test data, or there may be a shared set of test data in the database. The former makes tests more understandable and decoupled from each other. The latter can be used for also testing database migrations."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The test schema name may be hard-coded or unique. Unique names for each test make it possible to run tests in parallel. If the test process is killed, test teardown is never executed, so the tests should automatically remove stale test schemas (especially if using a shared long-running database instead of a local container/VM), or you will learn the database's soft and hard limits."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"Never run tests against a production database."}]},{"type":"text","value":" One safeguard is for the tests to only connect to a database whose name starts with \"test\"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Database tests can be made faster by "},{"type":"element","tagName":"a","properties":{"href":"https://pythonspeed.com/articles/faster-db-tests/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"disabling fsync or using a RAM disk"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"dead-ends","style":"position:relative;"},"children":[{"type":"text","value":"Dead ends"},{"type":"element","tagName":"a","properties":{"href":"#dead-ends","ariaLabel":"dead ends permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"could"}]},{"type":"text","value":" replace the database with an in-memory fake implementation for tests (e.g. hashmap). It will make the tests faster, but will require maintaining two parallel implementations - the real and the fake persistence layer. Even when using "},{"type":"element","tagName":"a","properties":{"href":"https://blog.thecodewhisperer.com/permalink/getting-started-with-contract-tests","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"contract tests"}]},{"type":"text","value":" to make the implementations functionally equivalent, they will be leaky abstractions with non-obvious differences (transactions, foreign key constraints etc.). It's better to decouple business logic from persistence: you won't need to fake dependencies if you have no dependencies."},{"type":"element","tagName":"a","properties":{"href":"https://imgflip.com/i/5kxd8x","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"¹"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Some people use an embedded in-memory database in tests and a different database in production, for example HSQLDB vs PostgreSQL. This is a road to madness. Even if SQL is a standard,"},{"type":"element","tagName":"a","properties":{"href":"https://xkcd.com/927/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"²"}]},{"type":"text","value":" each implementation is different, so you will anyways need to run the tests against both databases. It might avoid having to install a database and the data will be removed after the test process exits, but nowadays "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose up -d db"}]},{"type":"text","value":" is easy and even with an in-memory database you will need to handle isolation between test cases. Speed is not an argument either; a PostgreSQL which is already running is faster than a HSQLDB that needs to start every test run, not to speak of runtime performance. Most importantly, you would be limited to a subset of SQL that works on both databases, or you will need to maintain alternative versions of the queries; you would miss out on useful database-specific features such as "},{"type":"element","tagName":"a","properties":{"href":"https://www.postgresql.org/docs/13/plpgsql-trigger.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"triggers/stored procedures"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://medium.com/pyankit/postgres-range-types-are-dope-ca18923f3d46","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"range types"}]},{"type":"text","value":". Summa summarum, use the same technology in tests as in production."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"You just saved 5+ years of experimenting."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"network-sockets","style":"position:relative;"},"children":[{"type":"text","value":"Network sockets"},{"type":"element","tagName":"a","properties":{"href":"#network-sockets","ariaLabel":"network sockets permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Network socket port numbers are a global variable at the operating system level."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"If using a shared "},{"type":"element","tagName":"a","properties":{"href":"https://martinfowler.com/articles/continuousIntegration.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"continuous integration"}]},{"type":"text","value":" server, there can be many builds running on the same machine and they compete for the same port numbers. Even when running tests locally, you will typically have an application instance for manual testing running at the same time as the automated tests. The local development instance may use hard-coded ports, but the tests should allocate a random free port for the database and web server."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Most servers you can bind to listen on port 0 and the operating system will assign it an unused port number. After the server has started, you can find out what port was assigned to it and use that in the tests. "},{"type":"element","tagName":"a","properties":{"href":"https://docs.docker.com/compose/reference/port/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker compose port"}]}]},{"type":"text","value":" is handy for that. The other approach is to programmatically bind a socket to port 0, check what port number was assigned, close the socket, and then use that port number for starting the actual server - a port collision should be unlikely."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"P.S. Docker by default binds to network interface 0.0.0.0 and it "},{"type":"element","tagName":"a","properties":{"href":"https://github.com/moby/moby/issues/22054","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"bypasses the firewall"}]},{"type":"text","value":", so your development servers will be "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"publicly accessible even if your firewall is configured to block all incoming connections"}]},{"type":"text","value":". Always bind explicitly to 127.0.0.1 when publishing container ports to the host."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"time","style":"position:relative;"},"children":[{"type":"text","value":"Time"},{"type":"element","tagName":"a","properties":{"href":"#time","ariaLabel":"time permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Time is a global variable which is ever changing (hopefully monotonically increasing)."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Code which reads the current time (e.g. using "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"new Date()"}]},{"type":"text","value":") is inherently untestable. Instead, pass in the current time as a method parameter, or inject a "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Clock.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"clock"}]},{"type":"text","value":" which can be replaced with a "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Clock.html#fixed(java.time.Instant,java.time.ZoneId)","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"fake clock"}]},{"type":"text","value":" in tests."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"concurrency","style":"position:relative;"},"children":[{"type":"text","value":"Concurrency"},{"type":"element","tagName":"a","properties":{"href":"#concurrency","ariaLabel":"concurrency permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"The order of memory reads and writes between parallel threads, and the operating system's context switching, are unpredictable global variables."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"If a test fails randomly, don't ignore it as an outlier."}]},{"type":"text","value":" The code "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"has"}]},{"type":"text","value":" a concurrency bug, in the production or test code. Save any stack traces and logs of the failure, and "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"inspect the code ruthlessly"}]},{"type":"text","value":", until you know why it failed. It's important to know the "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Memory_model_(programming)","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"memory model"}]},{"type":"text","value":" of the programming language and the CPU."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Minimize the amount of code that needs to be thread-safe. Use "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Concurrency_pattern","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"concurrency abstractions"}]},{"type":"text","value":" which allow most of the code to be single-threaded. "},{"type":"element","tagName":"a","properties":{"href":"https://en.wikipedia.org/wiki/Immutable_object","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Immutability"}]},{"type":"text","value":" makes the code easier to reason about, also in single-threaded code."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don't use "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"sleep()"}]},{"type":"text","value":" in tests. The sleep time is either too long, making the tests slower, or too short, making them flaky (i.e. they fail randomly). Instead, react to events or use polling."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Concurrency artifacts such as "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CountDownLatch.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CountDownLatch"}]},{"type":"text","value":" and "},{"type":"element","tagName":"a","properties":{"href":"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CyclicBarrier.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"CyclicBarrier"}]},{"type":"text","value":" are useful for unit testing concurrent code. With them you can make thread 1 wait at point A, until thread 2 has arrived at point B."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://www.goodreads.com/quotes/506689-program-testing-can-be-used-to-show-the-presence-of","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Testing cannot prove"}]},{"type":"text","value":" that code is thread-safe, but together with code review, you can get quite far by writing a test which executes lots of tasks in parallel and then asserts invariants about what the tasks did. For example, each write happened exactly once, each task saw a consistent view of the state, tasks could read their own writes, and so on."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Always have a timeout for asynchronous tests, in case the code gets stuck in an infinite loop or deadlock or doesn't send some event. The timeout needs to be long enough to not be triggered randomly when the computer is overloaded, but short enough that you don't need to wait long for the tests to fail, especially if the wait time is "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"NumberOfTests * Timeout"}]},{"type":"text","value":"."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"randomness","style":"position:relative;"},"children":[{"type":"text","value":"Randomness"},{"type":"element","tagName":"a","properties":{"href":"#randomness","ariaLabel":"randomness permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TODO"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{"id":"user-interface","style":"position:relative;"},"children":[{"type":"text","value":"User interface"},{"type":"element","tagName":"a","properties":{"href":"#user-interface","ariaLabel":"user interface permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Tests should be sensitive to behavior changes and insensitive to structure changes. This is even more important in the user interface. Changing the visual style or layout of the UI, should not break behavioral tests."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are patterns like "},{"type":"element","tagName":"a","properties":{"href":"https://martinfowler.com/eaaDev/PassiveScreen.html","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"passive view"}]},{"type":"text","value":" which try to separate the logic and visuals of the UI, to make the logic more testable. With the advent of "},{"type":"element","tagName":"a","properties":{"href":"https://reactjs.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"React"}]},{"type":"text","value":", UI components can be written as stateless functions, which makes testing them easier."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"unit-testing-web-app-components","style":"position:relative;"},"children":[{"type":"text","value":"Unit testing web app components"},{"type":"element","tagName":"a","properties":{"href":"#unit-testing-web-app-components","ariaLabel":"unit testing web app components permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Asserting on the "},{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"innerText"}]},{"type":"text","value":" of a component (with whitespace normalization) produces tests which are decoupled from visual changes."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"div","properties":{},"children":[{"type":"text","value":"Asserting the presence/absence of a CSS class is useful for testing logic that is observable only visually. Make sure to use the same constant for presence and absence checks; a mispelled "},{"type":"comment","value":" sic "},{"type":"text","value":" CSS class is always absent."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"end-to-end-testing-web-apps","style":"position:relative;"},"children":[{"type":"text","value":"End-to-end testing web apps"},{"type":"element","tagName":"a","properties":{"href":"#end-to-end-testing-web-apps","ariaLabel":"end to end testing web apps permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Don't click buttons directly in test code. Create an automation layer of high-level operations and call those. The tests should focus on "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"what"}]},{"type":"text","value":" the system does, and the automation layer on "},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"how"}]},{"type":"text","value":" the system does it. That way when the UI changed, only the automation layer needs to be updated, instead of fixing all tests individually."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Prefer selecting elements based on the visible text on the button/link/label; it makes the tests easier to read. But don't be afraid to add extra IDs, classes and "},{"type":"element","tagName":"a","properties":{"href":"https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"data attributes"}]},{"type":"text","value":" to simplify testing."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Have only a few end-to-end tests. They are slow and flaky. Prefer unit tests. Set a hard limit for how many end-to-end tests the whole application may have (≤10 for even big apps) and stick to it. End-to-end tests should only check that things are wired together, not behavioral correctness."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{"id":"visual-testing","style":"position:relative;"},"children":[{"type":"text","value":"Visual testing"},{"type":"element","tagName":"a","properties":{"href":"#visual-testing","ariaLabel":"visual testing permalink","className":["anchor","after"]},"children":[{"type":"element","tagName":"svg","properties":{"ariaHidden":"true","focusable":"false","height":"16","version":"1.1","viewBox":"0 0 16 16","width":"16"},"children":[{"type":"element","tagName":"path","properties":{"fillRule":"evenodd","d":"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"},"children":[]}]}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"It's hard to write an assertion that something looks good. But for a human it's easy to check it visually, and the computer can compare whether the pixels have changed since the last approval."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"There are tools like "},{"type":"element","tagName":"a","properties":{"href":"https://storybook.js.org/","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"Storybook"}]},{"type":"text","value":" for rendering UI components in various states, and it's possible to "},{"type":"element","tagName":"a","properties":{"href":"https://storybook.js.org/docs/react/workflows/visual-testing","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"take a screenshot"}]},{"type":"text","value":" of the result and check whether it has changed."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Optimize the diff for humans. Even video and audio can be diffed as an image."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Read more:\n"},{"type":"element","tagName":"a","properties":{"href":"https://www.youtube.com/watch?v=5_IW7npQk9k","target":"_blank","rel":["noopener","noreferrer"]},"children":[{"type":"text","value":"https://www.youtube.com/watch?v=5_IW7npQk9k"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"hr","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"Proceed to "},{"type":"element","tagName":"a","properties":{"href":"/4-legacy-code"},"children":[{"type":"text","value":"Chapter 4: Legacy code"}]},{"type":"text","value":" or "},{"type":"element","tagName":"a","properties":{"href":"/exercises"},"children":[{"type":"text","value":"Exercises"}]}]}],"data":{"quirksMode":false}},"html":"<p>There are things which make testing more challenging. Many of them are global variables of sorts. Global variables cause spooky action at a distance. Do the same thing over and over again, and get a different result. Tests may randomly pass or fail, depending on the order in which they are run.</p>\n<h2 id=\"singletons\" style=\"position:relative;\">Singletons<a href=\"#singletons\" aria-label=\"singletons permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p><a href=\"https://en.wikipedia.org/wiki/Singleton_pattern\" target=\"_blank\" rel=\"noopener noreferrer\">Singleton</a> is an anti-pattern. It is the object-oriented equivalent of a global variable. Instead, <a href=\"http://www.butunclebob.com/ArticleS.UncleBob.SingletonVsJustCreateOne\" target=\"_blank\" rel=\"noopener noreferrer\">just create one</a>.</p>\n<h2 id=\"test-doubles\" style=\"position:relative;\">Test doubles<a href=\"#test-doubles\" aria-label=\"test doubles permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>If the SUT (system under test) is not a pure function and it's hard to test together with the real objects, its dependencies can be replaced with <a href=\"https://martinfowler.com/bliki/TestDouble.html\" target=\"_blank\" rel=\"noopener noreferrer\">test doubles</a>. The dependencies can be provided as method or constructor arguments (aka dependency injection).</p>\n<p>There are five main categories of test doubles:</p>\n<ul>\n<li><strong>Dummy</strong> is a placeholder to make the code compile, but doesn't affect the SUT.</li>\n<li><strong>Stub</strong> returns data to the SUT e.g. using hard-coded method return values.</li>\n<li><strong>Spy</strong> records how the SUT calls the spy, so that the test can afterwards assert on the recorded data.</li>\n<li><strong>Mock</strong> contains pre-recorded expectations on how the SUT should call it, and will itself automatically verify the expectations. Requires a mocking framework.</li>\n<li><strong>Fake</strong> is a simplified implementation of a dependency, not appropriate for production use, e.g. persistence layer based on a hashmap.</li>\n</ul>\n<p>Only mock types you own.</p>\n<p>Read more:\n<a href=\"https://jesusvalerareales.medium.com/testing-with-test-doubles-7c3abb9eb3f2\" target=\"_blank\" rel=\"noopener noreferrer\">https://jesusvalerareales.medium.com/testing-with-test-doubles-7c3abb9eb3f2</a>\n<a href=\"https://medium.com/@xpmatteo/how-i-learned-to-love-mocks-1-fb341b71328\" target=\"_blank\" rel=\"noopener noreferrer\">https://medium.com/@xpmatteo/how-i-learned-to-love-mocks-1-fb341b71328</a></p>\n<h3 id=\"london-school-of-tdd\" style=\"position:relative;\">London school of TDD<a href=\"#london-school-of-tdd\" aria-label=\"london school of tdd permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Mock objects were invented in a London meetup, and it gave birth to a mock-based outside-in approach to TDD, which is commonly called London style TDD. This is in contrast to Detroit/Chicago style TDD, where the code is typically written bottom-up and dependencies are faked only when they complicate testing (named such because Chrysler's C3 project, which gave birth to Extreme Programming, happened in Detroit). They are also known as mockist and classicist styles.</p>\n<p>London style TDD focuses on the communication protocols between objects sending messages to each other. It goes hand-in-hand <a href=\"https://groups.google.com/g/growing-object-oriented-software/c/-t6fp3392oM/m/QO342CHAAwAJ\" target=\"_blank\" rel=\"noopener noreferrer\">[1]</a> with <a href=\"https://en.wikipedia.org/wiki/Alan_Kay\" target=\"_blank\" rel=\"noopener noreferrer\">Alan Kay</a>'s view of object-oriented programming, where objects are like individual computers on the network sending messages to each other (thus Erlang is the most object-oriented programming language).</p>\n<p>When using mock objects, it's important to understand the object-oriented style for which they were created. Otherwise, over-mocking may lead to tight coupling between tests and implementation details. The best description of how mock objects were meant to be used is the book <em>Growing Object-Oriented Software, Guided by Tests</em> (Steve Freeman, Nat Pryce 2009).</p>\n<p>Read more:\n<a href=\"http://www.mockobjects.com/2009/09/brief-history-of-mock-objects.html\" target=\"_blank\" rel=\"noopener noreferrer\">http://www.mockobjects.com/2009/09/brief-history-of-mock-objects.html</a>\n<a href=\"https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.amazon.com/Growing-Object-Oriented-Software-Guided-Tests/dp/0321503627</a></p>\n<h2 id=\"file-system\" style=\"position:relative;\">File system<a href=\"#file-system\" aria-label=\"file system permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The file system is a global variable which persists between test executions.</p>\n<p>If a test needs to write to the disk, create a unique temporary directory on test setup and delete it recursively on teardown.</p>\n<p>If the test process is killed or there are file locks, the teardown may not be able to delete the temporary directory. Avoid using <code class=\"language-text\">/tmp</code> and instead place the temporary directory inside the project directory, under the build target directory, so that any stale directories will be removed on a clean build.</p>\n<h2 id=\"database\" style=\"position:relative;\">Database<a href=\"#database\" aria-label=\"database permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The database is a global variable which persists between test executions.</p>\n<p>Make it easy to run the tests locally. <a href=\"https://docs.docker.com/compose/\" target=\"_blank\" rel=\"noopener noreferrer\">Docker Compose</a> is simple and easy. For cloud-only databases, using a development instance in the cloud is necessary.</p>\n<p>Usually tests create the database schema on test setup, and remove it on teardown. Another style is to remove and recreate the schema on test setup, which makes it the responsibility of the next test to clean up what the previous test produced. Clean-before allows peeking the data after a test run, but you would still need to focus run a single test, so commenting out the teardown or using a sleep gives the same effect with the clean-after approach. Mom always told to clean up after yourself.</p>\n<p>In focused integration tests, it may be possible to run each test in a rollback-only transaction. This should make tests faster by avoiding the need to recreate the database schema for each test. If more than one thread is involved or the SUT is complex, this strategy is usually not possible.</p>\n<p>Tests may create their own test data, or there may be a shared set of test data in the database. The former makes tests more understandable and decoupled from each other. The latter can be used for also testing database migrations.</p>\n<p>The test schema name may be hard-coded or unique. Unique names for each test make it possible to run tests in parallel. If the test process is killed, test teardown is never executed, so the tests should automatically remove stale test schemas (especially if using a shared long-running database instead of a local container/VM), or you will learn the database's soft and hard limits.</p>\n<p><em>Never run tests against a production database.</em> One safeguard is for the tests to only connect to a database whose name starts with \"test\".</p>\n<p>Database tests can be made faster by <a href=\"https://pythonspeed.com/articles/faster-db-tests/\" target=\"_blank\" rel=\"noopener noreferrer\">disabling fsync or using a RAM disk</a>.</p>\n<h3 id=\"dead-ends\" style=\"position:relative;\">Dead ends<a href=\"#dead-ends\" aria-label=\"dead ends permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>You <em>could</em> replace the database with an in-memory fake implementation for tests (e.g. hashmap). It will make the tests faster, but will require maintaining two parallel implementations - the real and the fake persistence layer. Even when using <a href=\"https://blog.thecodewhisperer.com/permalink/getting-started-with-contract-tests\" target=\"_blank\" rel=\"noopener noreferrer\">contract tests</a> to make the implementations functionally equivalent, they will be leaky abstractions with non-obvious differences (transactions, foreign key constraints etc.). It's better to decouple business logic from persistence: you won't need to fake dependencies if you have no dependencies.<a href=\"https://imgflip.com/i/5kxd8x\" target=\"_blank\" rel=\"noopener noreferrer\">¹</a></p>\n<p>Some people use an embedded in-memory database in tests and a different database in production, for example HSQLDB vs PostgreSQL. This is a road to madness. Even if SQL is a standard,<a href=\"https://xkcd.com/927/\" target=\"_blank\" rel=\"noopener noreferrer\">²</a> each implementation is different, so you will anyways need to run the tests against both databases. It might avoid having to install a database and the data will be removed after the test process exits, but nowadays <code class=\"language-text\">docker compose up -d db</code> is easy and even with an in-memory database you will need to handle isolation between test cases. Speed is not an argument either; a PostgreSQL which is already running is faster than a HSQLDB that needs to start every test run, not to speak of runtime performance. Most importantly, you would be limited to a subset of SQL that works on both databases, or you will need to maintain alternative versions of the queries; you would miss out on useful database-specific features such as <a href=\"https://www.postgresql.org/docs/13/plpgsql-trigger.html\" target=\"_blank\" rel=\"noopener noreferrer\">triggers/stored procedures</a> and <a href=\"https://medium.com/pyankit/postgres-range-types-are-dope-ca18923f3d46\" target=\"_blank\" rel=\"noopener noreferrer\">range types</a>. Summa summarum, use the same technology in tests as in production.</p>\n<p>You just saved 5+ years of experimenting.</p>\n<h2 id=\"network-sockets\" style=\"position:relative;\">Network sockets<a href=\"#network-sockets\" aria-label=\"network sockets permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Network socket port numbers are a global variable at the operating system level.</p>\n<p>If using a shared <a href=\"https://martinfowler.com/articles/continuousIntegration.html\" target=\"_blank\" rel=\"noopener noreferrer\">continuous integration</a> server, there can be many builds running on the same machine and they compete for the same port numbers. Even when running tests locally, you will typically have an application instance for manual testing running at the same time as the automated tests. The local development instance may use hard-coded ports, but the tests should allocate a random free port for the database and web server.</p>\n<p>Most servers you can bind to listen on port 0 and the operating system will assign it an unused port number. After the server has started, you can find out what port was assigned to it and use that in the tests. <a href=\"https://docs.docker.com/compose/reference/port/\" target=\"_blank\" rel=\"noopener noreferrer\"><code class=\"language-text\">docker compose port</code></a> is handy for that. The other approach is to programmatically bind a socket to port 0, check what port number was assigned, close the socket, and then use that port number for starting the actual server - a port collision should be unlikely.</p>\n<p>P.S. Docker by default binds to network interface 0.0.0.0 and it <a href=\"https://github.com/moby/moby/issues/22054\" target=\"_blank\" rel=\"noopener noreferrer\">bypasses the firewall</a>, so your development servers will be <em>publicly accessible even if your firewall is configured to block all incoming connections</em>. Always bind explicitly to 127.0.0.1 when publishing container ports to the host.</p>\n<h2 id=\"time\" style=\"position:relative;\">Time<a href=\"#time\" aria-label=\"time permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Time is a global variable which is ever changing (hopefully monotonically increasing).</p>\n<p>Code which reads the current time (e.g. using <code class=\"language-text\">new Date()</code>) is inherently untestable. Instead, pass in the current time as a method parameter, or inject a <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Clock.html\" target=\"_blank\" rel=\"noopener noreferrer\">clock</a> which can be replaced with a <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/time/Clock.html#fixed(java.time.Instant,java.time.ZoneId)\" target=\"_blank\" rel=\"noopener noreferrer\">fake clock</a> in tests.</p>\n<h2 id=\"concurrency\" style=\"position:relative;\">Concurrency<a href=\"#concurrency\" aria-label=\"concurrency permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>The order of memory reads and writes between parallel threads, and the operating system's context switching, are unpredictable global variables.</p>\n<p><em>If a test fails randomly, don't ignore it as an outlier.</em> The code <em>has</em> a concurrency bug, in the production or test code. Save any stack traces and logs of the failure, and <em>inspect the code ruthlessly</em>, until you know why it failed. It's important to know the <a href=\"https://en.wikipedia.org/wiki/Memory_model_(programming)\" target=\"_blank\" rel=\"noopener noreferrer\">memory model</a> of the programming language and the CPU.</p>\n<p>Minimize the amount of code that needs to be thread-safe. Use <a href=\"https://en.wikipedia.org/wiki/Concurrency_pattern\" target=\"_blank\" rel=\"noopener noreferrer\">concurrency abstractions</a> which allow most of the code to be single-threaded. <a href=\"https://en.wikipedia.org/wiki/Immutable_object\" target=\"_blank\" rel=\"noopener noreferrer\">Immutability</a> makes the code easier to reason about, also in single-threaded code.</p>\n<p>Don't use <code class=\"language-text\">sleep()</code> in tests. The sleep time is either too long, making the tests slower, or too short, making them flaky (i.e. they fail randomly). Instead, react to events or use polling.</p>\n<p>Concurrency artifacts such as <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CountDownLatch.html\" target=\"_blank\" rel=\"noopener noreferrer\">CountDownLatch</a> and <a href=\"https://docs.oracle.com/en/java/javase/11/docs/api/java.base/java/util/concurrent/CyclicBarrier.html\" target=\"_blank\" rel=\"noopener noreferrer\">CyclicBarrier</a> are useful for unit testing concurrent code. With them you can make thread 1 wait at point A, until thread 2 has arrived at point B.</p>\n<p><a href=\"https://www.goodreads.com/quotes/506689-program-testing-can-be-used-to-show-the-presence-of\" target=\"_blank\" rel=\"noopener noreferrer\">Testing cannot prove</a> that code is thread-safe, but together with code review, you can get quite far by writing a test which executes lots of tasks in parallel and then asserts invariants about what the tasks did. For example, each write happened exactly once, each task saw a consistent view of the state, tasks could read their own writes, and so on.</p>\n<p>Always have a timeout for asynchronous tests, in case the code gets stuck in an infinite loop or deadlock or doesn't send some event. The timeout needs to be long enough to not be triggered randomly when the computer is overloaded, but short enough that you don't need to wait long for the tests to fail, especially if the wait time is <code class=\"language-text\">NumberOfTests * Timeout</code>.</p>\n<h2 id=\"randomness\" style=\"position:relative;\">Randomness<a href=\"#randomness\" aria-label=\"randomness permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>TODO</p>\n<h2 id=\"user-interface\" style=\"position:relative;\">User interface<a href=\"#user-interface\" aria-label=\"user interface permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h2>\n<p>Tests should be sensitive to behavior changes and insensitive to structure changes. This is even more important in the user interface. Changing the visual style or layout of the UI, should not break behavioral tests.</p>\n<p>There are patterns like <a href=\"https://martinfowler.com/eaaDev/PassiveScreen.html\" target=\"_blank\" rel=\"noopener noreferrer\">passive view</a> which try to separate the logic and visuals of the UI, to make the logic more testable. With the advent of <a href=\"https://reactjs.org/\" target=\"_blank\" rel=\"noopener noreferrer\">React</a>, UI components can be written as stateless functions, which makes testing them easier.</p>\n<h3 id=\"unit-testing-web-app-components\" style=\"position:relative;\">Unit testing web app components<a href=\"#unit-testing-web-app-components\" aria-label=\"unit testing web app components permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Asserting on the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/HTMLElement/innerText\" target=\"_blank\" rel=\"noopener noreferrer\">innerText</a> of a component (with whitespace normalization) produces tests which are decoupled from visual changes.</p>\n<div>Asserting the presence/absence of a CSS class is useful for testing logic that is observable only visually. Make sure to use the same constant for presence and absence checks; a mispelled <!-- sic --> CSS class is always absent.</div>\n<h3 id=\"end-to-end-testing-web-apps\" style=\"position:relative;\">End-to-end testing web apps<a href=\"#end-to-end-testing-web-apps\" aria-label=\"end to end testing web apps permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>Don't click buttons directly in test code. Create an automation layer of high-level operations and call those. The tests should focus on <em>what</em> the system does, and the automation layer on <em>how</em> the system does it. That way when the UI changed, only the automation layer needs to be updated, instead of fixing all tests individually.</p>\n<p>Prefer selecting elements based on the visible text on the button/link/label; it makes the tests easier to read. But don't be afraid to add extra IDs, classes and <a href=\"https://developer.mozilla.org/en-US/docs/Learn/HTML/Howto/Use_data_attributes\" target=\"_blank\" rel=\"noopener noreferrer\">data attributes</a> to simplify testing.</p>\n<p>Have only a few end-to-end tests. They are slow and flaky. Prefer unit tests. Set a hard limit for how many end-to-end tests the whole application may have (≤10 for even big apps) and stick to it. End-to-end tests should only check that things are wired together, not behavioral correctness.</p>\n<h3 id=\"visual-testing\" style=\"position:relative;\">Visual testing<a href=\"#visual-testing\" aria-label=\"visual testing permalink\" class=\"anchor after\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a></h3>\n<p>It's hard to write an assertion that something looks good. But for a human it's easy to check it visually, and the computer can compare whether the pixels have changed since the last approval.</p>\n<p>There are tools like <a href=\"https://storybook.js.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Storybook</a> for rendering UI components in various states, and it's possible to <a href=\"https://storybook.js.org/docs/react/workflows/visual-testing\" target=\"_blank\" rel=\"noopener noreferrer\">take a screenshot</a> of the result and check whether it has changed.</p>\n<p>Optimize the diff for humans. Even video and audio can be diffed as an image.</p>\n<p>Read more:\n<a href=\"https://www.youtube.com/watch?v=5_IW7npQk9k\" target=\"_blank\" rel=\"noopener noreferrer\">https://www.youtube.com/watch?v=5_IW7npQk9k</a></p>\n<hr>\n<p>Proceed to <a href=\"/4-legacy-code\">Chapter 4: Legacy code</a> or <a href=\"/exercises\">Exercises</a></p>","frontmatter":{"path":"/3-challenges","title":"Chapter 3: The Untestables","banner":null},"fileAbsolutePath":"/Users/esko/devel/tdd-mooc/data/3-challenges.md"}},"pageContext":{}},"staticQueryHashes":["3294351120","994120085"]}